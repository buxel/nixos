name: nixos
help: nixos-cli application
version: 0.1.0
extensible: true

commands:

- name: bootstrap
  alias: b
  help: Bootstrap a NixOS installation

  flags:
  - long: --config
    short: -c
    arg: config
    help: "name of NixOS configuration"
  - long: --hardware
    short: -h
    arg: hardware
    help: "direct, linode"
  - long: --firmware
    short: -f
    arg: firmware
    help: "uefi, bios"
  - long: --swap
    short: -s
    arg: swap
    help: "min, max, or any number of GB for swap (default: max)"

  examples:
  - nixos bootstrap --hardware linode
  - nixos bootstrap --firmware uefi --swap min
  - nixos bootstrap --firmware bios --swap 8
  - nixos bootstrap --config sol

- name: switch
  alias: sw
  help: Shortcut for nixos-rebuild switch

- name: secrets
  alias: s
  group: Secrets
  help: |-
    Edit or add secrets to secrets/files
    Wrapper for agenix --edit

  args:
  - name: secret
    required: false
    help: "name of secret (leave empty to choose from list)"

  flags:
  - long: --commit
    short: -c
    help: "Automatically commit changes to git"

  examples:
  - nixos secrets
  - nixos secrets foo

- name: rekey
  alias: r
  group: Secrets
  help: |-
    Rekey secrets with secrets/keys
    Wrapper for agenix --rekey

  flags:
  - long: --force
    short: -f
    help: "Force rekey even if no changes have been detected"
  - long: --commit
    short: -c
    help: "Automatically commit changes to git"

  examples:
  - nixos rekey
  - nixos rekey --force
  - nixos rekey --commit


- name: keyscan
  alias: k
  group: Secrets
  help: |-
    Scan a host for public keys and add to secrets/keys
    Wrapper for ssh-keyscan

  args:
  - name: ip
    required: true
    help: "IP address or hostname"
  - name: hostname
    required: false
    help: "Name of host (default: first argument)"

  flags:
  - long: --force
    short: -f
    help: "Force rekey after keyscan"
  - long: --add
    short: -a
    help: "Add extra host key instead of replacing"
  - long: --commit
    short: -c
    help: "Automatically commit changes to git"

  examples:
  - nixos keyscan 192.168.1.10 myhost
  - nixos keyscan 192.168.1.10 myhost --force
  - nixos keyscan 192.168.1.10 myhost --add --commit


# - name: linode
#   alias: l
#   help: Install configuration to Linode VPS
#
# - name: bootstrap
#   alias: b
#   help: Bootstrap a NixOS installation
#
#   args:
#   - name: type
#     required: true
#     help: "uefi, bios, linode"
#
#   - name: configuration
#     required: false
#     help: "Name of configuration"
#
#   flags:
#   - long: --swap
#     short: -s
#     arg: swap
#     help: "min, max, or any number of GB for swap (default: max)"
#
#   examples:
#   - nixos bootstrap linode
#   - nixos bootstrap uefi --swap min
#   - nixos bootstrap bios --swap 8
#   - nixos bootstrap switch sol

- name: bashly-generate
  alias: bg
  group: Utility
  help: Shortcut for bashly generate

- name: completions
  group: Utility
  help: |-
    Generate bash completions
    Usage: eval "\$(cli completions)" 

# - name: helpers
#   private: true
#   commands:
#     - name: ask
#       alias: a
#       help: Get input from user
